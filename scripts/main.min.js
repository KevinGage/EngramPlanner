function buildSkillsTable(){$.each(skills.skills,function(e,a){var r=document.createElement("div");$(r).data(a),$(r).attr("id",$(r).data("skillName").split(" ").join("")),$(r).addClass("skillitem"),$(r).css("background","url(img/engram/Spear_Icon.png)"),$(r).css("background","url("+$(r).data("image")+")"),$(r).css("background-size","contain"),$("#body").append(r);var t=document.createElement("span");t.innerHTML=$(r).data("skillName"),$(r).append(t);var n=document.createElement("div"),i=document.createElement("div");$(n).addClass("levelrequirementdiv"),$(i).addClass("engramrequirementdiv"),n.innerHTML=$(r).data("level"),i.innerHTML=$(r).data("engrams"),$(r).append(n),$(r).append(i),hasOwnProperty.call(this,"requires")&&$(r).hide(),a.level>character.level&&$(r).hide()}),$(".skillitem").hover(function(){$(this).data("selected")||$(this).animate({opacity:"1"},300);var e=$(this).data("skillName")+": "+$(this).data("description");updateDescriptionBar(e,$(this).data("requires"))},function(){$(this).data("selected")||$(this).animate({opacity:"0.5"},300)}),$(".skillitem").click(function(){$(this).data("selected")?deselectSkill($(this)):selectSkill($(this)),checkSkillDependencies($.data(this,"requiredBy"))}),$(window).resize(function(){resizeSkillWidth()}),resizeSkillWidth()}function resizeSkillWidth(){$(".skillitem").css({height:$(".skillitem").width()+"px"})}function fillLevels(){for(var e=1;65>=e;e++)$("#levelSelect").append($("<option>",{i:e}).text(e));return $("#levelSelect option:last-child").attr("selected","selected"),!0}function totalEngrams(){var e=character.engrams,a=parseInt($("#levelSelect option:selected").val());switch(character.level=a,!0){case 1===a:character.engrams=0;break;case a>=2&&10>a:character.engrams=8*(a-1);break;case a>=10&&20>a:character.engrams=64+12*(a-9);break;case a>=20&&30>a:character.engrams=184+16*(a-19);break;case a>=30&&40>a:character.engrams=344+20*(a-29);break;case a>=40&&50>a:character.engrams=544+24*(a-39);break;case a>=50&&60>a:character.engrams=784+28*(a-49);break;case a>=60&&65>a:character.engrams=1064+40*(a-59);break;case 65===a:character.engrams=1265;break;default:$("#totalEngrams").text("you a haxor")}return $("#totalEngrams").prop("number",e).animateNumber({number:character.engrams},200),!0}function checkSkillDependencies(e){for(var a=0;a<e.length;a++){var r=$("#"+e[a]);updateSkillView(r)}}function checkRequirements(e){var a="";if(e.data("engrams")>character.engrams-character.spent&&(a="engrams"),hasOwnProperty.call(e.data(),"requires"))for(var r=0;r<e.data("requires").length;r++)$("#"+e.data("requires")[r]).data("selected")||(a="requires");return e.data("level")>character.level&&(a="level"),a}function selectSkill(e){var a=checkRequirements(e);if(""===a)return character.spent+=e.data("engrams"),updateEngramDisplay(),e.data("selected",!0),e.addClass("selected"),e.animate({opacity:"1"},300),!0;switch(a){case"level":showError(e),showError($("#currentLevelDiv"));break;case"requires":showError(e),showError($("#requirementSpan"));for(var r=0;r<e.data("requires").length;r++)$("#"+e.data("requires")[r]).data("selected")||showError($("#"+e.data("requires")[r]));break;case"engrams":showError(e),showError($("#remainingEngramsDiv"));break;default:showError(e)}return!1}function deselectSkill(e){return 1==e.data("selected")&&(character.spent-=e.data("engrams"),updateEngramDisplay()),e.data("selected",!1),e.removeClass("selected"),e.animate({opacity:"0.5"},300),!0}function updateEngramDisplay(){var e=parseInt($("#spentEngrams").text()),a=parseInt($("#remainingEngrams").text()),r=character.engrams-character.spent;$("#spentEngrams").stop(!0),$("#remainingEngrams").stop(!0),$("#spentEngrams").prop("number",e).animateNumber({number:character.spent},200),$("#remainingEngrams").prop("number",a).animateNumber({number:r},200)}function loadSavedCharacter(){var e=getParameterByName("char");if(""!=e){var a=atob(e),r=a.split(",");character.level=parseInt(r[0]),$("#levelSelect").val(character.level).change(),totalEngrams();for(var t=document.querySelectorAll("#body .skillitem"),n=1;n<r.length;n++)selectSkill($(t[r[n]]));updateAllSkillViews()}}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=a.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function updateAllSkillViews(){$("#body>div").each(function(){updateSkillView($(this))})}function updateSkillView(e){var a=checkRequirements(e);if(""==a)return e.show(200),!0;switch(a){case"level":deselectSkill(e),"0"==$("#viewSelect option:selected").val()?e.hide(200):e.show(200);break;case"requires":deselectSkill(e),"0"==$("#viewSelect option:selected").val()?e.hide(200):e.show(200);break;default:e.show(200)}return!1}function showError(e){e.toggleClass("transition"),e.toggleClass("error"),setTimeout(function(){e.toggleClass("error"),e.toggleClass("transition")},750)}function updateDescriptionBar(e,a){if(void 0==a)a="none";else{requirementsWithSpaces="";for(var r=0;r<a.length;r++)requirementsWithSpaces+=a[r].split(/(?=[A-Z])/).join(" "),requirementsWithSpaces+=", ";a=requirementsWithSpaces.substring(0,requirementsWithSpaces.length-2)}$("#descriptionSpan").stop(!0),$("#requirementSpan").stop(!0),$("#descriptionSpan").animate({opacity:0},50).queue(function(){$("#descriptionSpan").text(e),$("#descriptionSpan").dequeue()}).animate({opacity:1},1e3),$("#requirementSpan").animate({opacity:0},50).queue(function(){$("#requirementSpan").text("Requires: "+a),$("#requirementSpan").dequeue()}).animate({opacity:1},1e3)}function fixNegativeEngrams(){if(character.engrams-character.spent<0)for(var e=document.querySelectorAll("#body .skillitem"),a=e.length-1;character.engrams-character.spent<0;)deselectSkill($(e[a])),a--}function saveCharacter(){for(var e=character.level.toString(),a=document.querySelectorAll("#body .skillitem"),r=0;r<a.length;r++)$(a[r]).data("selected")&&(e+=","+r.toString());var t=$(document).height();$("body").append("<div id='overlayDiv'></div>").hide().fadeIn("slow"),$overlayDiv=$("#overlayDiv"),$overlayDiv.height(t/3).css({"text-align":"center",opacity:.9,position:"absolute",top:t/3,"background-color":"black",width:"75%","z-index":5e3,"margin-left":"10%","margin-right":"10%",color:"white"});var n="?char="+btoa(e);$overlayDiv.append('<table id="saveTable">'),$overlayDiv.append("<tr>"),$overlayDiv.append("<td>"),$overlayDiv.append("Copy the link below to share your character!"),$overlayDiv.append("</td>"),$overlayDiv.append("</tr>"),$overlayDiv.append("<tr>"),$overlayDiv.append("<td>"),$overlayDiv.append('<a href="'+n+'">www.enjoythegame.net/arkplanner/'+n+"</a>"),$overlayDiv.append("</td>"),$overlayDiv.append("</tr>"),$overlayDiv.append("<tr>"),$overlayDiv.append("<td>"),$overlayDiv.append("<button id='close'>CLOSE</button>"),$overlayDiv.append("</td>"),$overlayDiv.append("</tr>"),$overlayDiv.append("</table>"),$("#close").ready(function(){$(document).on("click","#close",function(){$overlayDiv.fadeOut("slow",function(){$overlayDiv.remove()})})})}var skills={},character={level:0,engrams:0,spent:0};$(document).ready(function(){fillLevels(),totalEngrams(),$.getJSON("json/skills.json",function(e){skills=e,buildSkillsTable(),updateEngramDisplay(),loadSavedCharacter()}),$("#levelSelect").on("change",function(){totalEngrams(),fixNegativeEngrams(),updateAllSkillViews(),updateEngramDisplay()}),$("#viewSelect").on("change",function(){updateAllSkillViews()})});